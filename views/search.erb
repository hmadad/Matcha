<h1>Recherche</h1>
<hr>
<div class="row" style="margin-bottom: 10px">
  <div class="col-md-12">
    <form action="/search" class="form-inline" method="POST">
      <div class="col-md-12" style="margin-bottom: 20px;">
        <div class="form-group">
          <input type="text" class="form-control" name="search" placeholder="Exemple: Cuty" style="width: 100%">
        </div>
      </div>
      <div class="col-md-12"  style="margin-bottom: 20px;">
        <div class="row">
          <div class="col-md-6">
            <div class="row">
              <div class="col-md-6">
                <input type="number" class="form-control" name="min" min="18" max="120" placeholder="Age Minimum: (Min. 18)" style="width: 100%">
              </div>
              <div class="col-md-6">
                <input type="number" class="form-control" name="max" min="18" max="120" placeholder="Age Maximum: (Max. 120)" style="width: 100%">
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <input type="number" class="form-control" name="km" min="0" placeholder="Distance Maximum" style="width: 100%">
          </div>
        </div>
      </div>
      <div class="col-md-12"  style="margin-bottom: 20px;">
        <div class="row">
          <div class="col-md-12">
            <select class="form-control" name="order" style="width: 100%">
              <option value="">Tri</option>
              <option value="score">Score de popularit√©</option>
              <option value="tags">Tags en communs</option>
              <option value="location">Le plus proche</option>
            </select>
          </div>
        </div>
      </div>
      <div class="form-group col-md-2">
        <button type="submit" class="btn btn-primary" style="width: 100%">Envoyer</button>
      </div>
    </form>
  </div>
</div>
<hr>
<% if @result %>
  <div class="row">
      <% @result.each do |row| %>
        <%
          if row["location"] && row["location"].to_i != 0
            other_coords = loc(row["location"].to_i)
            if (params[:km].to_s == "illimite" || @km) || distance(@coord[0].to_f, @coord[1].to_f, other_coords[0].to_f, other_coords[1].to_f) < params[:km].to_f
        %>
              <a href="/users/profile/<%= row["id"] %>" style="color: #292b2c; text-decoration: none">
                <div class="card" style="width: 20rem; margin: 10px 30px;">
                  <div class="img-cadre" style="width: 100%; background-color: black">
                    <img class="rounded mx-auto d-block" src="<%= row["profile"] %>" alt="" width="200" height="200">
                  </div>
                  <div class="card-block">
                    <h4 class="card-title"><%= row["username"] %></h4>
                    <p class="card-text"><%= row["bio"] %></p>
                    <%
                      all_user = session[:auth]["interest"].split(", ")
                      all_other = row["interest"].split(", ")
                      comun = all_user & all_other
                      reste = all_other - all_user
                    %>
                    <p><b style="color: green"><%= comun.join(', ') %> </b><%= reste.join(', ') %></p>
                    <% if isLiked?(row["id"]) %>
                        <form action="/likes/dislike/<%= row["id"] %>" method="POST">
                          <button type="submit" class="btn btn-danger">Dislike <i class="fa fa-thumbs-down" aria-hidden="true"></i></button>
                        </form>
                    <% else %>
                        <form action="/likes/like/<%= row["id"] %>" method="POST">
                          <button type="submit" class="btn btn-success">Like <i class="fa fa-thumbs-o-up" aria-hidden="true"></i></button>
                        </form>
                    <% end %>
                  </div>
                </div>
              </a>
      <%
            end
          end
        end
      %>
  </div>
<% end %>
